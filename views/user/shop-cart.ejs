<%- include('../partials/userHeader') %> 
 
   <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                          
                          
                                <table class="table shopping-summery text-center clean">
                                  <thead>
                                    <tr class="main-heading">
                                      <th scope="col">Image</th>
                                      <th scope="col">Name</th>
                                      <th scope="col">Price</th>
                                      <th scope="col">Quantity</th>
                                      <th scope="col">Subtotal</th>
                                      <th scope="col">Remove</th>
                                    </tr>
                                  </thead>
                                  <% let cartTotal = 0; %>
                                  <% if(products) {%>
                                  <% for (let i = 0; i<products.length; i++) { %>
                                    <tbody>
                                      <tr>
                                        <% if (products[i].productImages[0].filename !== 'undefined') { %>
                                        <td class="image product-thumbnail"><img src="/uploads/<%=products[i].productImages[0].filename%>" alt="#"></td> 
                                        <% } %>
                                        <td class="product-des product-name">
                                          <h5 class="product-name"><a href="shop-product-right.html"> <%=products[i].productName %> </a></h5>
                                         
                                        </td>
                                        <td class="price" data-title="Price"><span>$<%=products[i].productCost %> </span></td>
                                        <td class="text-center" data-title="Stock">
                                            <div class="detail-qty border radius  m-auto">
                                               
                                                <a class="qty-down" onclick="changeQuantity( `<%=products[i].productName%>` ,`<%=products[i].productsId%>`,`<%=products[i].productCost%>`, -1)"><i class="fi-rs-angle-small-down"></i></a>

                                                <span class="qty-val" id="<%=products[i].productName%>"><%=products[i].qty%></span>
                                                
                                                <a  class="qty-up" onclick="changeQuantity(`<%=products[i].productName%>` ,`<%=products[i].productsId%>`,`<%=products[i].productCost%>`,1)"><i class="fi-rs-angle-small-up"></i></a>
                                                
                                            </div>
                                        </td>
                                        <!-- <td class="text-center" data-title="Stock">
                                            <div class="detail-qty border radius m-auto quantity-dropdown" data-product-id="<%= products[i].productName  %>">
                                                <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                                                <span class="qty-val" id="quantity-<%= i %>" data-quantity="<%=products[i].qty %>">
                                                  <%=products[i].qty %>
                                                </span>
                                                <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                                            </div>
                                            </td> -->
                                                <td class="price" data-title="Price" id="<%=products[i].productsId%>">$<span><%=products[i].subtotal; %> </span></td>
                                              
                                            <td class="price" data-title="Price"><a href="/deleteFromCart/<%=products[i].productsId %>" style="color:#088178;">delete</a></td>

                                            <% cartTotal += products[i].subtotal; %>
                                <% } %>
                               <% } %>
                                        </table>
                                
                        </div>
                    <script>            
  function changeQuantity(pName,prodId,pcost,count) {
    let quantity = parseInt(document.getElementById(pName).innerHTML) + parseInt(count);
    if (quantity <= 0) {
        // minimum quantity is 0
        quantity = 1;
    }
    //count = count;
    $.ajax({
      url: '/cart/updateQuantity',
      data: {   
        product: prodId,
        count: parseInt(count),
        quantity: parseInt(quantity),
        pCost:parseInt(pcost)
      },
      method: 'post',
      success: (response) => {
        if (response.removeProduct) {
          alert("Product Removed From the Cart");
          //location.reload();
          location.window.replace('/showCart');
        }
  
        else {
        //   document.getElementById(prod ).innerHTML = quantity + count
          document.getElementById('cart-total').innerHTML ="$" + response.total;
          document.getElementById(prodId).innerHTML = "$" +response.subtotal;
        }
      }
    })
  }




                        </script>
                       <div class="row">
                        <div class="col-md-6">
                          <div class="border p-md-4 p-30 border-radius cart-totals">
                            <div class="heading_s1 mb-3">
                              <h4>Cart Totals</h4>
                              <div class="table-responsive">
                                <table class="table">
                                  <tbody>
                                    <tr>
                                      <td class="cart_total_label">Shipping</td>
                                      <td class="cart_total_amount"><i class="ti-gift mr-5"></i> Free Shipping</td>
                                    </tr>
                                    <tr>
                                      <td class="cart_total_label">Total</td>
                                      <td class="cart_total_amount"><strong><span class="font-xl fw-900 text-brand" id="cart-total">$<%=cartTotal%></span></strong></td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                            <div class="cart-action text-end" style="margin-top: 20px;">
                                <a class="btn btn-success d-block" href="/checkOut"  style="margin-bottom: 30px;"><i class="fi-rs-box-alt mr-10"></i>Proceed To CheckOut</a>
                              <!-- <a class="btn btn-primary d-block mb-3"><i class="fi-rs-shuffle mr-10"></i>Update Cart</a> -->
                              <a class="btn btn-secondary d-block mb-3" href="/"><i class="fi-rs-shopping-bag mr-10"></i>Continue Shopping</a>
                            
                            </div>
                          </div>
                        <div class="divider center_icon mt-50 mb-50"><i class="fi-rs-fingerprint"></i></div>
                        <div class="row mb-50">
                            <div class="col-lg-6 col-md-12">
                              
                               
                                <div class="mb-30 mt-50">
                                    <div class="heading_s1 mb-3">
                                        <h4>Apply Coupon</h4>
                                    </div>
                                    <div class="total-amount">
                                        <div class="left">
                                            <div class="coupon">
                                                <form action="#" target="_blank">
                                                    <div class="form-row row justify-content-center">
                                                        <div class="form-group col-lg-6">
                                                            <input class="font-medium" name="Coupon" placeholder="Enter Your Coupon">
                                                        </div>
                                                        <div class="form-group col-lg-6">
                                                            <button class="btn  btn-sm"><i class="fi-rs-label mr-10"></i>Apply</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                           
                </div>
            </div>
        </section>
    </main>
    <footer class="main">
        <section class="newsletter p-30 text-white wow fadeIn animated">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-7 mb-md-3 mb-lg-0">
                        <div class="row align-items-center">
                            <div class="col flex-horizontal-center">
                                <img class="icon-email" src="assets/imgs/theme/icons/icon-email.svg" alt="">
                                <h4 class="font-size-20 mb-0 ml-3">Sign up to Newsletter</h4>
                            </div>
                            <div class="col my-4 my-md-0 des">
                                <h5 class="font-size-15 ml-4 mb-0">...and receive <strong>$25 coupon for first shopping.</strong></h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <!-- Subscribe Form -->
                        <form class="form-subcriber d-flex wow fadeIn animated">
                            <input type="email" class="form-control bg-white font-small" placeholder="Enter your email">
                            <button class="btn bg-dark text-white" type="submit">Subscribe</button>
                        </form>
                        <!-- End Subscribe Form -->
                    </div>
                </div>
            </div>
        </section>
        <section class="section-padding footer-mid">
            <div class="container pt-15 pb-20">
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <div class="widget-about font-md mb-md-5 mb-lg-0">
                            <div class="logo logo-width-1 wow fadeIn animated">
                                <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                            </div>
                            <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
                            <p class="wow fadeIn animated">
                                <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                            </p>
                            <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
                            <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                                <a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                                <a href="#"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3">
                        <h5 class="widget-title wow fadeIn animated">About</h5>
                        <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Delivery Information</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms &amp; Conditions</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Support Center</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-2  col-md-3">
                        <h5 class="widget-title wow fadeIn animated">My Account</h5>
                        <ul class="footer-list wow fadeIn animated">
                            <li><a href="#">Sign In</a></li>
                            <li><a href="#">View Cart</a></li>
                            <li><a href="#">My Wishlist</a></li>
                            <li><a href="#">Track My Order</a></li>
                            <li><a href="#">Help</a></li>
                            <li><a href="#">Order</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-4">
                        <h5 class="widget-title wow fadeIn animated">Install App</h5>
                        <div class="row">
                            <div class="col-md-8 col-lg-12">
                                <p class="wow fadeIn animated">From App Store or Google Play</p>
                                <div class="download-app wow fadeIn animated">
                                    <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active" src="assets/imgs/theme/app-store.jpg" alt=""></a>
                                    <a href="#" class="hover-up"><img src="assets/imgs/theme/google-play.jpg" alt=""></a>
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                                <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                                <img class="wow fadeIn animated" src="assets/imgs/theme/payment-method.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="container pb-20 wow fadeIn animated">
            <div class="row">
                <div class="col-12 mb-20">
                    <div class="footer-bottom"></div>
                </div>
                <div class="col-lg-6">
                    <p class="float-md-left font-sm text-muted mb-0">&copy; 2021, <strong class="text-brand">Evara</strong> - HTML Ecommerce Template </p>
                </div>
                <div class="col-lg-6">
                    <p class="text-lg-end text-start font-sm text-muted mb-0">
                        Designed by <a href="http://alithemes.com/" target="_blank">Alithemes.com</a>. All rights reserved
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Preloader Start -->
    <!-- <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div> -->
    <script>
        window.history.forward();
        function preventBack() {
          window.history.forward();
        }
        setTimeout("preventBack()", 0);
        window.onunload = function() {
          null
        };
      </script>
    <!-- Vendor JS-->
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="assets/js/plugins/slick.js"></script>
    <script src="assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="assets/js/plugins/wow.js"></script>
    <script src="assets/js/plugins/jquery-ui.js"></script>
    <script src="assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="assets/js/plugins/magnific-popup.js"></script>
    <script src="assets/js/plugins/select2.min.js"></script>
    <script src="assets/js/plugins/waypoints.js"></script>
    <script src="assets/js/plugins/counterup.js"></script>
    <script src="assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="assets/js/plugins/images-loaded.js"></script>
    <script src="assets/js/plugins/isotope.js"></script>
    <script src="assets/js/plugins/scrollup.js"></script>
    <script src="assets/js/plugins/jquery.vticker-min.js"></script>
    <!-- Template  JS -->
    <script src="assets/js/main.js"></script>
    <script src="assets/js/shop.js"></script>
    <script>
        // Send AJAX request to delete product from cart
        const deleteButtons = document.querySelectorAll('.delete-btn');
        deleteButtons.forEach(button => {
            button.addEventListener('click', () => {
                const productId = button.dataset.productId;
                const xhr = new XMLHttpRequest();
                xhr.open('DELETE', `/cart/${productId}`);
                xhr.onload = () => {
                    if (xhr.status === 200) {
                        window.location.reload();
                    } else {
                        console.error(xhr.statusText);
                    }
                };
                xhr.send();
            });
        });
    
        // Send AJAX request to update quantity
        const quantityDropdowns = document.querySelectorAll('.quantity-dropdown');
        quantityDropdowns.forEach(dropdown => {
            const productId = dropdown.dataset.productId;
            const quantitySpan = dropdown.querySelector('.qty-val');
            const quantity = quantitySpan.dataset.quantity;
            const quantityUpButton = dropdown.querySelector('.qty-up');
            const quantityDownButton = dropdown.querySelector('.qty-down');
    
            quantityUpButton.addEventListener('click', () => {
                const xhr = new XMLHttpRequest();
                xhr.open('PUT', `/cart/${productId}?qty=${Number(quantity)+1}`);
                xhr.onload = () => {
                    if (xhr.status === 200) {
                        quantitySpan.dataset.quantity = Number(quantity)+1;
                        quantitySpan.innerText = Number(quantity)+1;
                        window.location.reload();
                    } else {
                        console.error(xhr.statusText);
                    }
                };
                xhr.send();
            });
    
            quantityDownButton.addEventListener('click', () => {
                if (quantity > 1) {
                    const xhr = new XMLHttpRequest();
                    xhr.open('PUT', `/cart/${productId}?qty=${Number(quantity)-1}`);
                    xhr.onload = () => {
                        if (xhr.status === 200) {
                            quantitySpan.dataset.quantity = Number(quantity)-1;
                            quantitySpan.innerText = Number(quantity)-1;
                            window.location.reload();
                        } else {
                            console.error(xhr.statusText);
                        }
                    };
                    xhr.send();
                }
            });
        });
    </script>
    
</body>


<!-- Mirrored from wp.alithemes.com/html/evara/evara-frontend/shop-cart.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:26:06 GMT -->
</html>